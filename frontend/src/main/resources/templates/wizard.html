<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Enhort - Genomic Position Profiling - Guided Analysis</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" media="screen" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/result.css" th:href="@{/css/result.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/celllinetree.css" th:href="@{/css/celllinetree.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/wizard.css" th:href="@{/css/wizard.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/data.css" th:href="@{/css/data.css}"/>

    <script src="/js/jquery-1.12.0.min.js" th:href="@{/js/jquery-1.12.0.min.js}"></script>
    <script src="/js/bootstrap.min.js" th:href="@{/js/bootstrap.min.js}"></script>

</head>

<body>

<div th:include="header:: bar"></div>

<div class="container">
    <div class="row">
        <div class="col-11">


        <th:block th:switch="${page}">
            <th:block th:case="'upload'">

                <div id="wizardheader">
                   Upload File

                    <span class="glyphicon glyphicon-info-sign wizinfo" data-toggle="tooltip"
                          data-placement="bottom"
                          title="Please upload a file in the .bed-file format containing a set of genomic positions."></span>

                </div>


            </th:block>
            <th:block th:case="'tracks'">

                 <div id="wizardheader">
                   Select Annotations

                     <span class="glyphicon glyphicon-info-sign wizinfo" data-toggle="tooltip"
                           data-placement="bottom"
                           title="On this page you can select a set of genomic annotations. Your uploaded sites will be tested against each of the selected annotations.
                            Results will be displayed on the next page."></span>
                 </div>

            </th:block>
        </th:block>

        <th:block th:if="${message != null}">
            <div class="bg-danger" th:text="${message}"></div>
        </th:block>

        <div id="wizardouter">

            <th:block th:switch="${page}">
                <th:block th:case="'upload'">
                    <p>Please upload a bed-file with genomic positions:</p>
                    <div class="box">
                        <form method="POST" enctype="multipart/form-data" action="/wizfile" id="uploadform">
                            <!-- Bed file -->
                            <div>
                                <input type="file" name="file" id="file" class="btn"/>
                                <button onclick="this.disabled=true;this.form.submit();" class="btn" id="uploadbtn">Continue</button>
                            </div>

                        </form>
                    </div>
                </th:block>


                <th:block th:case="'tracks'">

                    <form method="POST" action="/wizresult" id="uploadform" th:object="${interfaceCommand}">

                        <div id="file"><!-- prevent js type error null --></div>

                        <div id="header_out">
                            <!-- Assembly -->

                            <div id="header_in1">
                                <div class="dropdown">
                                    <button class="btn btn-default dropdown-toggle" type="button"
                                            data-toggle="dropdown"><span th:text="${interfaceCommand.assembly}"></span>
                                        <span class="caret"></span></button>
                                    <ul class="dropdown-menu">
                                        <li><a href="#">hg18</a></li>
                                        <li><a href="#">hg19</a></li>
                                        <li><a href="#">hg38</a></li>
                                    </ul>
                                </div>
                            </div>

                            <div id="header_in2">
                                <button id="submitTracks" onclick="this.form.submit();" class="btn btn-primary right">Continue</button>
                                <button class="btn btn-default right" id="clearbtn_wiz">Clear</button>
                            </div>
                        </div>

                        <hr />
                        <div id="counter">0 tracks selected</div>

                        <div id="datatable" class="table-responsive">
                        <table class="table table-hover">

                            <col width="150"/>
                            <th:block th:each="track: ${trackNames}">
                                <col width="15"/>
                            </th:block>


                            <thead>
                                <tr>
                                    <th class="noborder"><!-- Cell line column--></th>
                                    <th:block th:each="track: ${trackNames}">
                                        <th class="colheader"><div class="trackname" th:text="${track}" th:title="${track}"></div></th>
                                    </th:block>
                                </tr>
                            </thead>

                            <th:block th:if="${#lists.isEmpty(celllines)}">

                                <div id="error" class="bg-danger">
                                    No annotation data from the backend server, please try again in a few minutes.
                                </div>
                            </th:block>

                            <tbody>
                                <th:block th:each="cl: ${celllines}">
                                    <th:block th:if="${#lists.isEmpty(cl.value)}">
                                        <tr class="clrow">
                                            <td class="rowheader" th:text="${cl.key}"></td>

                                                <th:block th:each="pack: ${ids}">
                                                    <th:block th:if="${cl.key == pack.key}">

                                                        <th:block th:each="value,iter: ${pack.value}">

                                                            <td class="row" th:if="${value != -1}"><input class="check" type="checkbox" th:field="${interfaceCommand.tracks}" th:value="${value}" th:title="${'Track '+ trackNames[iter.index] + ' for ' + cl.key}"/></td>
                                                            <td class="row" th:if="${value == -1}"></td>
                                                        </th:block>
                                                    </th:block>
                                                </th:block>
                                        </tr>

                                    </th:block>

                                    <th:block th:if="${not #lists.isEmpty(cl.value)}">

                                        <tr class="clrow">
                                            <td class="rowheader" th:text="${cl.key}"></td>
                                        </tr>

                                        <th:block th:each="inner: ${cl.value}">

                                            <tr class="clrow">
                                                <td class="subrowheader rowheader" th:text="${inner}"></td>

                                                    <th:block th:each="pack: ${ids}">
                                                        <th:block th:if="${inner == pack.key}">

                                                            <th:block th:each="value: ${pack.value}">

                                                                <td class="row" th:if="${value != -1}"><input class="check" type="checkbox" th:field="${interfaceCommand.tracks}" th:value="${value}"/></td>
                                                                <td class="row" th:if="${value == -1}"></td>
                                                            </th:block>
                                                        </th:block>
                                                    </th:block>

                                            </tr>
                                        </th:block>
                                    </th:block>
                                </th:block>

                            </tbody>
                        </table>

                        </div>


                        Sequence Logo:<input class="check" type="checkbox" title="Sequence Logo" th:field="${interfaceCommand.logo}"/>
                    </form>

                </th:block>
            </th:block>


        </div>

    </div>

        <div class="col-1">
            <img id="wizard" src="title_logo_wizard.png"/>
        </div>

    </div>
</div>

<script>
    document.getElementById("submitTracks").disabled = true;
</script>

<script>
    document.getElementById("file").onchange = function() {
        document.getElementById("uploadform").submit();
    };
</script>


<script>

    function count() {
        var counter = 0;

        $("input[type='checkbox']").each(function (id, box) {
            if(box.checked === true)
                counter++;
        });

        document.getElementById("counter").innerHTML = counter + " tracks selected";

        if(counter > 0)
            document.getElementById("submitTracks").disabled = false;
    }

    count(); //count once at loading to get tracks selected by session
    document.getElementById("datatable").onclick = function () { count(); }
</script>

<script>
    $(".acidjs-css3-treeview").delegate("label input:checkbox", "change", function () {
        var
            checkbox = $(this),
            nestedList = checkbox.parent().next().next(),
            selectNestedListCheckbox = nestedList.find("label:not([for]) input:checkbox");

        if (checkbox.is(":checked")) {
            return selectNestedListCheckbox.prop("checked", true);
        }
        selectNestedListCheckbox.prop("checked", false);
    });
</script>

<script src="/js/celltable.js" th:href="@{/js/celltable.js}" ></script>

<script>
    document.getElementById("clearbtn_wiz").onclick = function (event) {

        document.getElementById("submitTracks").disabled = true;

        event.preventDefault();

        $("input[type='checkbox']").each(function (id, box) {
            box.checked = false;
        });

        document.getElementById("counter").innerHTML = "0 tracks selected";
    }

</script>


<script>
    $(function () {
        $('[data-toggle="tooltip"]').tooltip({
            container: 'body'

        });
    });

    $('.checked').prop('checked', true);

</script>


</body>
</html>