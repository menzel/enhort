<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Enhort - Wizard</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" media="screen" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/faq.css" th:href="@{/css/faq.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/result.css" th:href="@{/css/result.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/celllinetree.css" th:href="@{/css/celllinetree.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/wizard.css" th:href="@{/css/wizard.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/data.css" th:href="@{/css/data.css}"/>

    <script src="/js/jquery-1.12.0.min.js" th:href="@{/js/jquery-1.12.0.min.js}"></script>
    <script src="/js/bootstrap.min.js" th:href="@{/js/bootstrap.min.js}"></script>

</head>

<body style="padding-top: 100px">

<div th:include="header:: bar"></div>

<div class="col-xs-10 col-xs-offset-2 col-sm-6 col-sm-offset-2 col-md-7 col-md-offset-2 main">
    <div class="container row col-md-12">

        <th:block th:switch="${page}">
            <th:block th:case="'upload'">
                <object id="workflowsvg" data="img/wizbar_small1.svg" type="image/svg+xml"></object>
                <img id="wizard" src="title_logo_wizard.png">

                <div id="wizardheader">
                   Upload File
                    <div class="right">
                        Step 1 of 3
                    </div>
                </div>

            </th:block>
            <th:block th:case="'tracks'">
                <object id="workflowsvg" data="img/wizbar_small2.svg" type="image/svg+xml" onclick="window.history.back();"></object>
                <img id="wizard" src="title_logo_wizard.png">

                 <div id="wizardheader">
                   Select Annotations
                    <div class="right">
                        Step 2 of 3
                    </div>
                 </div>


            </th:block>
            <th:block th:case="'covariates'">
                <object id="workflowsvg" data="img/wizbar_small3.svg" type="image/svg+xml" onclick="window.history.back();"></object>
                <img id="wizard" src="title_logo_wizard.png">

                <div id="wizardheader">
                   Select Covariates
                    <div class="right">
                        Step 3 of 3
                    </div>
                </div>

            </th:block>
        </th:block>

        <th:block th:if="${message != null}">
            <div class="bg-danger" th:text="${message}"></div>
        </th:block>

        <div id="wizardouter">

            <th:block th:switch="${page}">
                <th:block th:case="'upload'">
                    <p>Please upload a bed-file with genomic positions:</p>
                    <div class="box">
                        <form method="POST" enctype="multipart/form-data" action="/wizfile" id="uploadform">
                            <!-- Bed file -->
                            <div>
                                <input type="file" name="file" id="file" class="btn"/>
                                <button onclick="this.disabled=true;this.form.submit();" class="btn" id="uploadbtn">Continue</button>
                            </div>

                        </form>
                    </div>
                </th:block>


                <th:block th:case="'tracks'">

                    <form method="POST" enctype="multipart/form-data" action="/wizcov" id="uploadform" th:object="${interfaceCommand}">

                        <input style="display: none" type="file" name="file" id="file"/>

                        <div id="header_out">
                            <!-- Assembly -->

                            <div id="header_in1">
                                <p style="float: left;">
                                    The annotations are based on
                                </p>

                                <div class="dropdown show">
                                    <a class="btn btn-secondary dropdown-toggle" href="#" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <span th:text="${interfaceCommand.assembly}"></span>
                                        <span class="caret"></span>
                                    </a>

                                    <div class="dropdown-menu" aria-labelledby="dropdownMenuLink">
                                        <a class="dropdown-item" href="#">hg18</a>
                                        <a class="dropdown-item" href="#">hg19</a>
                                        <a class="dropdown-item" href="#">hg38</a>
                                    </div>
                                </div>
                            </div>

                            <div id="header_in2">
                                <button id="submitTracks" onclick="this.form.submit();" class="btn btn-primary right">Continue</button>
                                <button class="btn btn-default right" id="clearbtn_wiz">Clear</button>
                            </div>
                        </div>

                        <hr />
                        <div id="counter">0 tracks selected</div>

                        Select one or more presets:
                        <div id="presets">
                            <div class="preset"><label>
                                <input type="checkbox">
                                 Suggested tracks
                            </label></div>
                            <div class="preset"><label>
                                <input type="checkbox">
                            Histone modifications
                            </label></div>
                            <div class="preset"><label>
                                <input type="checkbox">
                            Genotoxicity
                            </label></div>
                            <div class="preset"><label>
                                <input type="checkbox">
                            Genome segmentation
                            </label></div>
                            <div class="preset"><label>
                                <input type="checkbox">
                            Expression levels
                            </label></div>

                        </div>

                        <div id="datatable" class="table-responsive">
                        <table class="table table-hover">

                            <col width="150">
                            <th:block th:each="track: ${trackNames}">
                                <col width="15">
                            </th:block>


                            <thead>
                                <tr>
                                    <th><!-- Cell line column--></th>
                                    <th:block th:each="track: ${trackNames}">
                                        <th class="colheader"><div class="trackname" th:text="${track}" th:title="${track}"></div></th>
                                    </th:block>
                                </tr>
                            </thead>


                            <tbody>
                                <th:block th:each="cl: ${celllines}">
                                    <th:block th:if="${#lists.isEmpty(cl.value)}">
                                        <tr class="clrow">
                                            <td class="rowheader" th:text="${cl.key}"></td>

                                                <th:block th:each="pack: ${ids}">
                                                    <th:block th:if="${cl.key == pack.key}">

                                                        <th:block th:each="value,iter: ${pack.value}">

                                                            <td class="row" th:if="${value != -1}"><input class="check" type="checkbox" th:field="${interfaceCommand.tracks}" th:value="${value}" th:title="${'Track '+ trackNames[iter.index] + ' for ' + cl.key}"></td>
                                                            <td class="row" th:if="${value == -1}"></td>
                                                        </th:block>
                                                    </th:block>
                                                </th:block>
                                        </tr>

                                    </th:block>

                                    <th:block th:if="${not #lists.isEmpty(cl.value)}">

                                        <tr class="clrow">
                                            <td class="rowheader" th:text="${cl.key}"></td>
                                        </tr>

                                        <th:block th:each="inner: ${cl.value}">

                                            <tr class="clrow">
                                                <td class="subrowheader rowheader" th:text="${inner}"></td>

                                                    <th:block th:each="pack: ${ids}">
                                                        <th:block th:if="${inner == pack.key}">

                                                            <th:block th:each="value: ${pack.value}">

                                                                <td class="row" th:if="${value != -1}"><input class="check" type="checkbox" th:field="${interfaceCommand.tracks}" th:value="${value}"></td>
                                                                <td class="row" th:if="${value == -1}"></td>
                                                            </th:block>
                                                        </th:block>
                                                    </th:block>

                                            </tr>
                                        </th:block>
                                    </th:block>
                                </th:block>

                            </tbody>
                        </table>

                        </div>


                        Sequence Logo:<input class="check" type="checkbox" title="Sequence Logo" th:field="${interfaceCommand.logo}">
                    </form>

                </th:block>


                <th:block th:case="'covariates'">


                    <form method="POST" action="/covariate" id="uploadform">

                        <input th:value="${interfaceCommand.assembly}" th:field="*{interfaceCommand.assembly}"
                               type="hidden"/>
                        <input th:value="${interfaceCommand.tracks}" th:field="*{interfaceCommand.tracks}"
                               type="hidden"/>
                        <input th:value="${interfaceCommand.logo}" th:field="*{interfaceCommand.logo}"
                               type="hidden"/>

                        <button type="button" onclick="window.history.back();" class="btn btn-default">Back</button>

                        <button onclick="this.disabled=true;this.form.submit();" class="btn btn-primary right">Continue</button>

                        <h4>Skip this step if you want a random background. Otherwise upload a file with background sites:</h4>

                        <input type="file" name="file" id="file" class="btn"/>

                        <hr/>
                        <h3>-Or-</h3>

                        <h4>choose Covariates to adapt the background model:</h4>

                        <table class="table table-hover fixed covariates">

                            <thead><tr>
                                <th th:text="${'Significant tracks' + ' (' + sigTrackCount + '/' + trackCount + ')'}"
                                    data-toggle="tooltip" data-placement="right" title="Count of significant tracks vs all tracks">
                                    Significant Tracks
                                </th>

                                <th data-toggle="tooltip" data-placement="right" title="P-value computed by chi-square-test">P Value
                                </th>
                                <th>Effect Size</th>
                                <th>Relative Integration<span style="font-size: 10px;"> <span
                                        style="color: #337ab7; font-size: 13px;">Data</span> vs. <span
                                        style="color: #555; font-size: 13px;"> Background</span></span></th>
                                <th>Covariate</th>
                            </tr></thead>


                            <th:block th:each="result: ${tracks}">
                                <tr>
                                    <td th:text="${result.name}"></td>
                                    <td th:text="${result.pValue}"></td>
                                    <td th:text="${result.effectSize}"></td>
                                    <td class="bars">
                                        <div class="bar measured" th:style="'width: ' + ${result.percentInM} + '%;'"></div>
                                        <div class="bar expected" th:style="'width: ' + ${result.percentInE} + '%;'"></div>
                                    </td>
                                    <td><input th:field="*{interfaceCommand.covariants}" th:value="${result.id}"
                                               type="checkbox"/></td>
                                </tr>
                            </th:block>
                        </table>

                        <!-- Covariates -->

                        <button onclick="this.disabled=true;this.form.submit();" class="btn btn-primary right">Continue</button>
                    </form>
                </th:block>

            </th:block>
        </div>

    </div>

    <label class="coll"><span class="glyphicon glyphicon-info-sign"></span></label>
    <div>

</div>
</div>

<script>
    document.getElementById("submitTracks").disabled = true;
</script>

<script>
    document.getElementById("file").onchange = function() {
        document.getElementById("uploadform").submit();
    };
</script>


<script>

    function count() {
        var counter = 0;

        $("input[type='checkbox']").each(function (id, box) {
            if(box.checked === true)
                counter++;
        });

        document.getElementById("counter").innerHTML = counter + " tracks selected";

        if(counter > 0)
            document.getElementById("submitTracks").disabled = false;
    }

    count(); //count once at loading to get tracks selected by session
    document.getElementById("datatable").onclick = function () { count(); }
</script>

<script>
    $(".acidjs-css3-treeview").delegate("label input:checkbox", "change", function () {
        var
            checkbox = $(this),
            nestedList = checkbox.parent().next().next(),
            selectNestedListCheckbox = nestedList.find("label:not([for]) input:checkbox");

        if (checkbox.is(":checked")) {
            return selectNestedListCheckbox.prop("checked", true);
        }
        selectNestedListCheckbox.prop("checked", false);
    });
</script>

<script src="/js/celltable.js" th:href="@{/js/celltable.js}" ></script>

<script>
    document.getElementById("clearbtn_wiz").onclick = function (event) {

        document.getElementById("submitTracks").disabled = true;

        event.preventDefault();

        $("input[type='checkbox']").each(function (id, box) {
            box.checked = false;
        });

        document.getElementById("counter").innerHTML = "0 tracks selected";
    }

</script>


</body>
</html>