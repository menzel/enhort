<!DOCTYPE html SYSTEM "http://www.thymeleaf.org/dtd/xhtml1-strict-thymeleaf-spring4-4.dtd">
<html xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8"/>
    <title>Enhort - FAQ</title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <link rel="stylesheet" media="screen" href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" />
    <link rel="stylesheet" media="screen" href="../static/css/faq.css" th:href="@{/css/faq.css}" />
    <link rel="stylesheet" media="screen" href="../static/css/result.css" th:href="@{/css/result.css}"/>
    <link rel="stylesheet" media="screen" href="../static/css/celllinetree.css" th:href="@{/css/celllinetree.css}"/>

    <script src="/js/jquery-1.12.0.min.js" th:href="@{/js/jquery-1.12.0.min.js}" ></script>
    <script src="/js/bootstrap.min.js" th:href="@{/js/bootstrap.min.js}" ></script>

</head>

<body style="padding-top: 100px">

    <div th:include="header:: bar"></div>

    <div class="col-xs-10 col-xs-offset-2 col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
        <div class="container row col-md-12">

            <img src="title_logo_wizard.png"/>

                <th:block th:switch="${page}">
                    <th:block th:case="'upload'">
                        <p>Welcome to Enhort. Please upload a bed-file with genomic positions:</p>
                          <div class="box">
                          <form method="POST" enctype="multipart/form-data" action="/wiz" id="uploadform">
                              <!-- Bed file -->
                              <div>
                                <input type="file" name="file" id="file" class="btn"/>
                              </div>

                              <!-- Assembly -->

                             <div class="box">
                                <h4>Assembly</h4>
                                <select id="assembly" class="form-control" name="assembly">
                                    <option th:value="${interfaceCommand.assembly}" th:text="${interfaceCommand.assembly}"></option>
                                    <option value="hg18">hg18</option>
                                    <option value="hg19" selected="selected">hg19</option>
                                    <option value="hg38">hg38</option>
                                </select>
                             </div>
                              <button class="btn btn-primary" id="down">Continue</button>
                            </form>
                          </div>
                    </th:block>


                    <th:block th:case="'packages'">
                       <!-- Cell line -->

                        <form method="POST" enctype="multipart/form-data" action="/wiz" id="uploadform">


                            <input style="display: none" type="file" name="file" id="file"/>

                            <!--  code from http://experiments.wemakesites.net/css3-treeview-with-multiple-node-selection.html -->
                            <div class="acidjs-css3-treeview">
                               <ul>
                               <li>
                                    <input type="checkbox" id="cb_all" checked="checked"/> <!-- Collapse triangle -->
                                    <label>
                                        <input type="checkbox" th:field="*{interfaceCommand.celllines}" th:value="${'all'}"/>
                                        <span></span>
                                    </label>
                                    <label for="cb_all">(De-)Select all</label>

                                    <ul>
                                        <th:block th:each="cellline: ${celllines}">
                                            <li>
                                                <th:block th:if="${ not #lists.isEmpty(cellline.value)}">
                                                    <input type="checkbox" th:id="'cb_' + *{#strings.replace(cellline.key, ' ', '_')}"/> <!-- Collapse triangle -->
                                                    <label><input type="checkbox" th:field="*{interfaceCommand.celllines}" th:value="*{#strings.replace(cellline.key, ' ', '_')}"/><span></span></label>
                                                    <label th:for="'cb_' + *{#strings.replace(cellline.key, ' ', '_')}" th:text="${cellline.key}"></label>
                                                </th:block>

                                                <th:block th:if="${#lists.isEmpty(cellline.value)}">
                                                    <input type="checkbox" th:id="'cb_' + *{#strings.replace(cellline.key, ' ', '_')}"/> <!-- Collapse triangle -->
                                                    <label><input type="checkbox" th:field="*{interfaceCommand.celllines}" th:value="*{#strings.replace(cellline.key, ' ', '_')}"/><span></span></label>
                                                    <span th:for="'cb_' + *{#strings.replace(cellline.key, ' ', '_')}" th:text="${cellline.key} " class="pad"></span>
                                                </th:block>

                                                <th:block th:if="${ not #lists.isEmpty(cellline.value)}">
                                                    <ul>
                                                    <th:block th:each="inner: ${cellline.value}">
                                                        <li>
                                                            <input type="checkbox" th:id="'cb_' + ${#strings.replace(inner, ' ', '_')}"/> <!-- Collapse triangle -->
                                                            <label><input type="checkbox" th:field="*{interfaceCommand.celllines}" th:value="*{#strings.replace(inner, ' ', '_')}"/><span></span></label>
                                                            <span th:for="'cb_' + *{#strings.replace(inner, ' ', '_')}" th:text="${inner}" class="pad"></span>
                                                        </li>
                                                    </th:block>
                                                    </ul>
                                                </th:block>
                                            </li>
                                        </th:block>
                                    </ul>
                                </li>
                                </ul>
                            </div>


                      <!-- Track packages -->

                        <th:block th:each="packName: ${trackPackages}">
                            <div class="checkbox">
                                <label><input type="checkbox" th:field="*{interfaceCommand.packageNames}" th:value="${packName}"
                                              checked="checked" th:text="${packName}"/></label>

                            </div>
                        </th:block>

                        <button class="btn btn-primary" id="down">Continue</button>
                        </form>
                    </th:block>


                    <th:block th:case="'covariates'">

                        <form method="POST" action="/covariate" id="uploadform">

                            <input th:value="${interfaceCommand.assembly}" th:text="${interfaceCommand.assembly}" th:field="*{interfaceCommand.assembly}"/>
                            <h3>Choose Covariates</h3>

                            <table class="table table-hover fixed">
                            <th:block th:each="result: ${tracks}">
                                <tr>
                                    <td th:text="${result.name}"></td>
                                    <td th:text="${result.pValue}"></td>
                                    <td th:text="${result.effectSize}"></td>
                                    <td class="bars">
                                        <div class="bar measured" th:style="'width: ' + ${result.percentInM} + '%;'"></div>
                                        <div class="bar expected" th:style="'width: ' + ${result.percentInE} + '%;'"></div>
                                    </td>
                                    <td><input th:field="*{interfaceCommand.covariants}" th:value="${result.id}" type="checkbox"/></td>
                                </tr>
                            </th:block>
                            </table>

                            <!-- Covariates -->

                            <button type="submit" class="btn btn-primary" id="upload_btn">Start</button>
                        </form>
                    </th:block>

                </th:block>

            </div>
         </div>
    </div>
</body>


<!-- auto start upload -->
<script>
document.getElementsByName("down").onclick = function() {
     window.scrollBy(0, 100);
};

document.getElementById("file").onchange = function() {
    document.getElementById("upload_btn").disabled = true;
    document.getElementById("uploadform").submit();
};
</script>


<script>
  $(".acidjs-css3-treeview").delegate("label input:checkbox", "change", function() {
      var
          checkbox = $(this),
          nestedList = checkbox.parent().next().next(),
          selectNestedListCheckbox = nestedList.find("label:not([for]) input:checkbox");

      if(checkbox.is(":checked")) {
          return selectNestedListCheckbox.prop("checked", true);
      }
      selectNestedListCheckbox.prop("checked", false);
  });
</script>

</html>